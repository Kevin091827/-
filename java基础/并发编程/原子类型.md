# 一，java中的原子操作类型

jdk1.5开始提供了Atomic包，这个包中的原子操作类提供了一种用法简单，性能高效，线程安全的更新一个变量的方式

# 二，原子更新基本类型

该类用于原子的更新基本类型：

- AtomicInteger
- AtomicBoolean
- AtomicLong

```java
/**
 * @Description:    原子更新基本类型
 * @Author:         Kevin
 * @CreateDate:     2019/7/1 21:34
 * @UpdateUser:     Kevin
 * @UpdateDate:     2019/7/1 21:34
 * @UpdateRemark:   修改内容
 * @Version: 1.0
 */
public class AtomicIntergerTest {

    static AtomicInteger atomicInteger = new AtomicInteger(1);
    
    public static void main(String[] args) {
        //原子的方式增加指定的值
        System.out.println("--------->" + atomicInteger.addAndGet(1));
        //compareAndSet(int expect,int update)如果expect = atomicInteger.get() 则将该atomicInteger.get()设置为update
        System.out.println("--------->"+atomicInteger.compareAndSet(1,2)+atomicInteger.get());
        //自增1，返回的是自增前的值
        System.out.println("--------->"+atomicInteger.getAndIncrement());
        //自减1，返回的是自减前的值
        System.out.println("--------->"+atomicInteger.getAndDecrement());
        //延时更新
        atomicInteger.lazySet(1);
    }
}
```

## 原子更新原理

1.getAndIncrement()原理

注意点：

- atomicInteger.compareAndSet(current,next)

这是进行原子更新操作的重点，检查当前原子值是否等于current（期望值），如果相等，就是当前原子值没有被其他线程修改，可以进行更新操作

```java
    /**
     * getAndIncrement()原理
     * @return
     */
    public static int getAndIncrement(){
        for(;;){
            //获取当前原子值
            int current = get();
            //自增
            int next = current+1;
            //如果当前原子值 == current 就将当前原子值设置为next
            if(atomicInteger.compareAndSet(current,next)){
                //返回自增前原子值
                return current;
            }
        }
    }
```